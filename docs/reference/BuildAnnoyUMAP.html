<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Run UMAP on a Seurat object — BuildAnnoyUMAP • pochi</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run UMAP on a Seurat object — BuildAnnoyUMAP"><meta name="description" content="Run UMAP on a Seurat object"><meta property="og:description" content="Run UMAP on a Seurat object"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pochi</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/pochi-Seurat.html">Using pochi with Seurat</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Run UMAP on a Seurat object</h1>

      <div class="d-none name"><code>BuildAnnoyUMAP.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Run UMAP on a Seurat object</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">BuildAnnoyUMAP</span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  neighbors_slot <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">dims</span>,</span>
<span>  reduction <span class="op">=</span> <span class="st">"pca"</span>,</span>
<span>  features <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  graph_key <span class="op">=</span> <span class="st">"annoy"</span>,</span>
<span>  assay <span class="op">=</span> <span class="fu">DefaultAssay</span><span class="op">(</span><span class="va">object</span><span class="op">)</span>,</span>
<span>  slot <span class="op">=</span> <span class="st">"scale.data"</span>,</span>
<span>  n.neighbors <span class="op">=</span> <span class="fl">30L</span>,</span>
<span>  n.components <span class="op">=</span> <span class="fl">2L</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"cosine"</span>,</span>
<span>  n.epochs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prune.snn <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">15</span>,</span>
<span>  learning.rate <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  min.dist <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>  spread <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  set.op.mix.ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  local.connectivity <span class="op">=</span> <span class="fl">1L</span>,</span>
<span>  repulsion.strength <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  negative.sample.rate <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  a <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  b <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  uwot.sgd <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  seed.use <span class="op">=</span> <span class="fl">42</span>,</span>
<span>  metric.kwds <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  angular.rp.forest <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  reduction_key <span class="op">=</span> <span class="st">"UMAP_"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  reduction.name <span class="op">=</span> <span class="st">"umap"</span>,</span>
<span>  return.model <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  save.graphs <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  init.pos <span class="op">=</span> <span class="st">"spectral"</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>A Seurat object</p></dd>


<dt id="arg-neighbors-slot">neighbors_slot<a class="anchor" aria-label="anchor" href="#arg-neighbors-slot"></a></dt>
<dd><p>Name of the Neighbors slot in object to utilize for
pre-computed kNN, such as with FindMultiModalNeighbors. Leave NULL if
want to calculate kNN utilizing the remaining arguments in this function.</p></dd>


<dt id="arg-dims">dims<a class="anchor" aria-label="anchor" href="#arg-dims"></a></dt>
<dd><p>Which dimensions from the reduction to use as input features</p></dd>


<dt id="arg-reduction">reduction<a class="anchor" aria-label="anchor" href="#arg-reduction"></a></dt>
<dd><p>Which dimensional reduction to use for the
UMAP input.</p></dd>


<dt id="arg-features">features<a class="anchor" aria-label="anchor" href="#arg-features"></a></dt>
<dd><p>If NULL, run UMAP on this subset of features (instead of running on a
set of reduced dimensions).</p></dd>


<dt id="arg-graph-key">graph_key<a class="anchor" aria-label="anchor" href="#arg-graph-key"></a></dt>
<dd><p>graph key, specifies the string before the name of the returned graphs.
annoy by default</p></dd>


<dt id="arg-assay">assay<a class="anchor" aria-label="anchor" href="#arg-assay"></a></dt>
<dd><p>Assay to pull data for when using <code>features</code>, or assay used to construct Graph
if running UMAP on a Graph</p></dd>


<dt id="arg-slot">slot<a class="anchor" aria-label="anchor" href="#arg-slot"></a></dt>
<dd><p>The slot used to pull data for when using <code>features</code>. data slot is by default.</p></dd>


<dt id="arg-n-neighbors">n.neighbors<a class="anchor" aria-label="anchor" href="#arg-n-neighbors"></a></dt>
<dd><p>This determines the number of neighboring points used in
local approximations of manifold structure. Larger values will result in more
global structure being preserved at the loss of detailed local structure. In
general this parameter should often be in the range 5 to 50.</p></dd>


<dt id="arg-n-components">n.components<a class="anchor" aria-label="anchor" href="#arg-n-components"></a></dt>
<dd><p>The dimension of the space to embed into.</p></dd>


<dt id="arg-metric">metric<a class="anchor" aria-label="anchor" href="#arg-metric"></a></dt>
<dd><p>metric: This determines the choice of metric used to measure
distance in the input space. A wide variety of metrics are already coded, and
a user defined function can be passed as long as it has been JITd by numba.</p></dd>


<dt id="arg-n-epochs">n.epochs<a class="anchor" aria-label="anchor" href="#arg-n-epochs"></a></dt>
<dd><p>he number of training epochs to be used in optimizing the low dimensional
embedding. Larger values result in more accurate embeddings. If NULL is specified, a value will
be selected based on the size of the input dataset (200 for large datasets, 500 for small).</p></dd>


<dt id="arg-prune-snn">prune.snn<a class="anchor" aria-label="anchor" href="#arg-prune-snn"></a></dt>
<dd><p>Sets the cutoff for acceptable Jaccard index when computing
the neighborhood overlap for the SNN construction. Any edges with values less
than or equal to this will be set to 0 and removed from the SNN graph.
Essentially sets the stringency of pruning (0 — no pruning, 1 — prune
everything).</p></dd>


<dt id="arg-learning-rate">learning.rate<a class="anchor" aria-label="anchor" href="#arg-learning-rate"></a></dt>
<dd><p>The initial learning rate for the embedding optimization.</p></dd>


<dt id="arg-min-dist">min.dist<a class="anchor" aria-label="anchor" href="#arg-min-dist"></a></dt>
<dd><p>This controls how tightly the embedding is allowed compress points together.
Larger values ensure embedded points are moreevenly distributed, while smaller values allow the
algorithm to optimise more accurately with regard to local structure. Sensible values are in
the range 0.001 to 0.5.</p></dd>


<dt id="arg-spread">spread<a class="anchor" aria-label="anchor" href="#arg-spread"></a></dt>
<dd><p>The effective scale of embedded points. In combination with min.dist this
determines how clustered/clumped the embedded points are.</p></dd>


<dt id="arg-set-op-mix-ratio">set.op.mix.ratio<a class="anchor" aria-label="anchor" href="#arg-set-op-mix-ratio"></a></dt>
<dd><p>Interpolate between (fuzzy) union and intersection as the set operation
used to combine local fuzzy simplicial sets to obtain a global fuzzy simplicial sets. Both fuzzy
set operations use the product t-norm. The value of this parameter should be between 0.0 and
1.0; a value of 1.0 will use a pure fuzzy union, while 0.0 will use a pure fuzzy intersection.</p></dd>


<dt id="arg-local-connectivity">local.connectivity<a class="anchor" aria-label="anchor" href="#arg-local-connectivity"></a></dt>
<dd><p>The local connectivity required - i.e. the number of nearest neighbors
that should be assumed to be connected at a local level. The higher this value the more connected
the manifold becomes locally. In practice this should be not more than the local intrinsic
dimension of the manifold.</p></dd>


<dt id="arg-repulsion-strength">repulsion.strength<a class="anchor" aria-label="anchor" href="#arg-repulsion-strength"></a></dt>
<dd><p>Weighting applied to negative samples in low dimensional embedding
optimization. Values higher than one will result in greater weight being given to negative
samples.</p></dd>


<dt id="arg-negative-sample-rate">negative.sample.rate<a class="anchor" aria-label="anchor" href="#arg-negative-sample-rate"></a></dt>
<dd><p>The number of negative samples to select per positive sample in the
optimization process. Increasing this value will result in greater repulsive force being applied,
greater optimization cost, but slightly more accuracy.</p></dd>


<dt id="arg-a">a<a class="anchor" aria-label="anchor" href="#arg-a"></a></dt>
<dd><p>More specific parameters controlling the embedding. If NULL, these values are set
automatically as determined by min. dist and spread. Parameter of differentiable approximation of
right adjoint functor.</p></dd>


<dt id="arg-b">b<a class="anchor" aria-label="anchor" href="#arg-b"></a></dt>
<dd><p>More specific parameters controlling the embedding. If NULL, these values are set
automatically as determined by min. dist and spread. Parameter of differentiable approximation of
right adjoint functor.</p></dd>


<dt id="arg-uwot-sgd">uwot.sgd<a class="anchor" aria-label="anchor" href="#arg-uwot-sgd"></a></dt>
<dd><p>Set <code>uwot::umap(fast_sgd = TRUE)</code>; see <code><a href="https://jlmelville.github.io/uwot/reference/umap.html" class="external-link">umap</a></code> for more details</p></dd>


<dt id="arg-seed-use">seed.use<a class="anchor" aria-label="anchor" href="#arg-seed-use"></a></dt>
<dd><p>Set a random seed. By default, sets the seed to 42. Setting
NULL will not set a seed</p></dd>


<dt id="arg-metric-kwds">metric.kwds<a class="anchor" aria-label="anchor" href="#arg-metric-kwds"></a></dt>
<dd><p>A dictionary of arguments to pass on to the metric, such as the p value for
Minkowski distance. If NULL then no arguments are passed on.</p></dd>


<dt id="arg-angular-rp-forest">angular.rp.forest<a class="anchor" aria-label="anchor" href="#arg-angular-rp-forest"></a></dt>
<dd><p>Whether to use an angular random projection forest to initialise the
approximate nearest neighbor search. This can be faster, but is mostly on useful for metric that
use an angular style distance such as cosine, correlation etc. In the case of those metrics
angular forests will be chosen automatically.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Controls verbosity</p></dd>


<dt id="arg-reduction-name">reduction.name<a class="anchor" aria-label="anchor" href="#arg-reduction-name"></a></dt>
<dd><p>Name to store dimensional reduction under in the Seurat object</p></dd>


<dt id="arg-return-model">return.model<a class="anchor" aria-label="anchor" href="#arg-return-model"></a></dt>
<dd><p>whether UMAP will return the uwot model</p></dd>


<dt id="arg-save-graphs">save.graphs<a class="anchor" aria-label="anchor" href="#arg-save-graphs"></a></dt>
<dd><p>If TRUE, then in addition to the embedding, also return
nearest neighbor graphs (fuzzy, kNN, SNN, and cosine) as Graph objects in
the Seurat object</p></dd>


<dt id="arg-init-pos">init.pos<a class="anchor" aria-label="anchor" href="#arg-init-pos"></a></dt>
<dd><p>Type of initialization for the coordinates. See uwot::umap
for more details.</p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>Scaling to apply to embeddings. See uwot::umap</p></dd>


<dt id="arg-densmap">densmap<a class="anchor" aria-label="anchor" href="#arg-densmap"></a></dt>
<dd><p>Whether to use the density-augmented objective of densMAP.
Turning on this option generates an embedding where the local densities
are encouraged to be correlated with those in the original space.
Parameters below with the prefix ‘dens’ further control the behavior
of this extension. Default is FALSE. Only compatible with 'umap-learn' method
and version of umap-learn &gt;= 0.5.0</p></dd>


<dt id="arg-densmap-kwds">densmap.kwds<a class="anchor" aria-label="anchor" href="#arg-densmap-kwds"></a></dt>
<dd><p>A dictionary of arguments to pass on to the densMAP optimization.</p></dd>


<dt id="arg-dens-lambda">dens.lambda<a class="anchor" aria-label="anchor" href="#arg-dens-lambda"></a></dt>
<dd><p>Specific parameter which controls the regularization weight
of the density correlation term in densMAP. Higher values prioritize density
preservation over the UMAP objective, and vice versa for values closer to zero.
Setting this parameter to zero is equivalent to running the original UMAP algorithm.
Default value is 2.</p></dd>


<dt id="arg-dens-frac">dens.frac<a class="anchor" aria-label="anchor" href="#arg-dens-frac"></a></dt>
<dd><p>Specific parameter which controls the fraction of epochs
(between 0 and 1) where the density-augmented objective is used in densMAP.
The first (1 - dens_frac) fraction of epochs optimize the original UMAP
objective before introducing the density correlation term. Default is 0.3.</p></dd>


<dt id="arg-dens-var-shift">dens.var.shift<a class="anchor" aria-label="anchor" href="#arg-dens-var-shift"></a></dt>
<dd><p>Specific parameter which specifies a small constant
added to the variance of local radii in the embedding when calculating
the density correlation objective to prevent numerical instability from
dividing by a small number. Default is 0.1.</p></dd>


<dt id="arg-reduction-key">reduction.key<a class="anchor" aria-label="anchor" href="#arg-reduction-key"></a></dt>
<dd><p>dimensional reduction key, specifies the string before
the number for the dimension names. UMAP by default</p></dd>

</dl></div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Diego A Espinoza.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.2.</p>
</div>

    </footer></div>





  </body></html>

